import feedparser
import urllib3.request
import shutil
import re

linkList = []
linksList = []
nameList = []
dir = './audio/'
lastDateFile = open('lastdate.txt')
#open file and read saved date

file = open('feeds.txt')
for url in file.xreadlines():
	feed = feedparser.parse(url)
	feedDate = feedparser._parse_date(feed['entries'][0]['pubDate'])
	if feedDate > lastDate:
		linksList.append(feed['entries'][0]['links'])
		name = re.sub("[-,: ]",'',feed['entries'][0]['title'])
		nameList.append(name)
file.close()

#update saved date of last operation

for links in linksList:
	for link in links:
		if link['type'] == "audio/mpeg":
			linkList.append(link['href'])

http = urllib3.PoolManager()
for i in range(len(linkList)):
	with http.urlopen('GET',linkList[i],preload_content=False) as response, open(dir+nameList[i]+'.mp3', 'wb') as out_file:
		shutil.copyfileobj(response, out_file)
